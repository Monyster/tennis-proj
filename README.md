# 🏓 Пінг-Понг з Друзями

MVP додатку для дружньої гри в настільний теніс 2 на 2 з системою ротації команд, черги та голосування за результат.

## ✨ Особливості

- 🎮 Гра 2 на 2 з можливістю непарної кількості гравців (5, 7, 9...)
- 🔄 Автоматична ротація команд після матчу
- 📊 Система фори для чемпіонів (серія перемог)
- 🗳️ Голосування за результат матчу (30% від усіх гравців)
- 📈 Статистика гравців (перемоги, поразки, win%)
- 👥 Формування команд через інвайти
- ⚡ Реал-тайм синхронізація через Firebase

## 🚀 Швидкий старт

### 1. Встановлення залежностей

```bash
npm install
```

### 2. Налаштування Firebase

1. Створіть проект у [Firebase Console](https://console.firebase.google.com/)
2. Увімкніть Realtime Database у режимі test
3. Скопіюйте конфігурацію проекту
4. Створіть файл `.env.local` на основі `.env.local.example`:

```bash
cp .env.local.example .env.local
```

5. Заповніть `.env.local` вашими даними з Firebase:

```env
NEXT_PUBLIC_FIREBASE_API_KEY=your_api_key_here
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_project_id.firebaseapp.com
NEXT_PUBLIC_FIREBASE_DATABASE_URL=https://your_project_id.firebaseio.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project_id
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your_project_id.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
NEXT_PUBLIC_FIREBASE_APP_ID=your_app_id
```

### 3. Запуск проекту

```bash
npm run dev
```

Відкрийте [http://localhost:3000](http://localhost:3000) у браузері.

## 📖 Як грати

### Створення гри

1. Введіть своє ім'я
2. Натисніть "Створити кімнату"
3. Поділіться кодом кімнати (формат: `PING-XXXX`) з друзями

### Приєднання до гри

1. Введіть своє ім'я
2. Введіть код кімнати
3. Натисніть "Приєднатись"

### Лобі

- Формуйте команди, відправляючи інвайти іншим гравцям
- Коли буде мінімум 4 гравці, хост може почати гру
- При непарній кількості гравців один залишається на лаві

### Гра

- Грайте матч до 11 очків
- Підрахунок ведіть самостійно
- Після завершення всі голосують за результат
- При досягненні 30% голосів відбувається автоматична ротація

### Ротація (парна кількість)

- Переможці залишаються за столом
- Програвші йдуть в кінець черги
- Нова команда приходить з початку черги

### Ротація (непарна кількість)

- З програвшої команди один залишається (хто зіграв менше матчів)
- Другий йде на лаву
- Гравець з лави + той хто залишився = нова команда

### Фора

| Серія перемог | Фора | Перша подача |
|---------------|------|--------------|
| 0 (новий чемпіон) | 0 | — |
| 1 | +2 | чемпіони |
| 2 | +4 | претенденти |
| 3 | +6 | чемпіони |
| n | +2n | чергується |

## 🏗️ Технічний стек

- **Frontend:** Next.js 16 (App Router), React 19, TypeScript
- **Styling:** Tailwind CSS v4
- **Backend/DB:** Firebase Realtime Database
- **State Management:** React Hooks + Firebase реалтайм підписки
- **Deployment:** Vercel (рекомендовано)

## 📁 Структура проекту

```
/app
  ├── page.tsx                    # Головна сторінка
  ├── room/[code]/page.tsx        # Кімната (лобі + гра)
  └── layout.tsx

/components
  ├── CreateRoom.tsx              # Створення кімнати
  ├── JoinRoom.tsx                # Приєднання
  ├── Lobby.tsx                   # Лобі
  ├── Game.tsx                    # Матч
  ├── TeamCard.tsx                # Команда
  ├── PlayerCard.tsx              # Гравець
  ├── VoteButtons.tsx             # Голосування
  ├── Queue.tsx                   # Черга
  ├── Bench.tsx                   # Лава
  ├── InviteModal.tsx             # Інвайти
  └── Stats.tsx                   # Статистика

/lib
  ├── firebase.ts                 # Конфігурація Firebase
  ├── useRoom.ts                  # Хук роботи з кімнатою
  └── utils.ts                    # Допоміжні функції

/types
  └── index.ts                    # TypeScript типи
```

## 🎨 Патерни та архітектура

- **Presentation Components** - чисті UI компоненти
- **Container Pattern** - `useRoom` hook як контейнер логіки
- **Repository Pattern** - Firebase операції інкапсульовані
- **Command Pattern** - дії (actions) у useRoom
- **Singleton Pattern** - Firebase ініціалізація

## 🔒 Firebase Security Rules

⚠️ **Для MVP використовуються тестові правила. Для продакшену обов'язково налаштуйте валідацію!**

Базові правила (test mode):
```json
{
  "rules": {
    "rooms": {
      "$roomCode": {
        ".read": true,
        ".write": true
      }
    }
  }
}
```

```bash
# Відкрий кілька incognito вікон (Ctrl+Shift+N)
# Кожне вікно = окремий гравець
```

### Перевірка коду:

```bash
# Білд перевірка
npm run build

# Лінтинг
npm run lint
```

## 📝 TODO для продакшену

- [ ] Додати Firebase Security Rules з валідацією
- [ ] Реалізувати Toast нотифікації
- [ ] Додати звукові ефекти
- [ ] PWA підтримка
- [ ] Темна тема
- [ ] Багатомовність (EN, UA)
- [ ] Історія матчів
- [ ] Експорт статистики

## 🤝 Внесок

Вітаються пулл-реквести! Для великих змін спочатку створіть issue.

## 🤝 Типу роадмап


###
 1. Авторизація

**
Оцінка: 🔥 Must Have (Критично)
**

|
 Аспект 
|
 Деталі 
|

|
--------
|
--------
|

|
 Цінність 
|
 Висока — без неї неможлива персистентна статистика, профілі, захист від спуфінгу імен 
|

|
 Складність 
|
 Середня (Firebase Auth має готові провайдери) 
|

|
 Рекомендація 
|
 Google Sign-In як основний метод (швидко, без паролів) + Anonymous auth для гостей 
|


**
Підзадачі:
**

-
 Firebase Authentication setup
-
 Міграція з localStorage імені на Auth UID
-
 Зв'язування гравця з профілем
-
 Гостьовий режим (anonymous) для швидкого старту
---

###
 2. Глобальна статистика

**
Оцінка: 🔥 Must Have
**

|
 Аспект 
|
 Деталі 
|

|
--------
|
--------
|

|
 Цінність 
|
 Висока — мотивація гравців, соціальний елемент 
|

|
 Складність 
|
 Середня (потребує окрему колекцію в Firebase + агрегацію) 
|

|
 Залежності 
|
 Потребує авторизації 
|


**
Підзадачі:
**

-
 Глобальний лідерборд (топ-100 за win%, за кількістю ігор)
-
 Історія матчів гравця
-
 Детальна статистика: найдовша серія перемог, улюблені партнери, найчастіші суперники
-
 ELO/MMR рейтинг (опціонально)
---

###
 3. Режим 1 на 1

**
Оцінка: 🔥 Must Have
**

|
 Аспект 
|
 Деталі 
|

|
--------
|
--------
|

|
 Цінність 
|
 Висока — розширює аудиторію, класичний формат 
|

|
 Складність 
|
 Низька-середня (спрощена версія існуючої логіки) 
|

|
 Рекомендація 
|
 Реалізувати як окремий game mode 
|


**
Підзадачі:
**

-
 Новий тип кімнати: 
`mode: '1v1' | '2v2'`

-
 Спрощена ротація (переможець залишається)
-
 Адаптація UI для 2 гравців
-
 Окрема статистика для 1v1 та 2v2
---

###
 4. Трекінг подач

**
Оцінка: ⭐ Nice to Have (Цінна фіча)
**

|
 Аспект 
|
 Деталі 
|

|
--------
|
--------
|

|
 Цінність 
|
 Середня — додає глибину статистиці 
|

|
 Складність 
|
 Середня (потребує UI для відмітки кожного очка) 
|

|
 Ризик 
|
 Може ускладнити UX, якщо грати "на швидку руку" 
|


**
Підзадачі:
**

-
 Індикатор поточного подаючого (зміна кожні 2 очки)
-
 Кнопки "+1 очко" для кожної команди
-
 Статистика: виграні/програні подачі
-
 Можливість вимкнути детальний трекінг (quick mode)
---

##
 Нові запропоновані фічі

###
 🎯 High Priority (Phase 2)

####
 5. Турнірний режим

**
Цінність: Висока
**

Організація турнірів з bracket-системою:
-
 Single/Double elimination
-
 Round Robin для малих груп
-
 Автоматична генерація сітки
-
 Фінали з best-of-3/5
-
 Шерінг турнірної сітки
####
 6. Досягнення та бейджі

**
Цінність: Висока (гейміфікація)
**

-
 "Перша перемога", "10 перемог поспіль", "100 матчів"
-
 "Comeback King" — виграв з 0-10
-
 "Perfect Game" — 11-0
-
 "Social Butterfly" — грав з 20+ різними партнерами
-
 Анімовані бейджі в профілі
####
 7. Друзі та команди

**
Цінність: Висока
**

-
 Список друзів
-
 Запрошення в кімнату через push/link
-
 Постійні команди (duo з улюбленим партнером)
-
 Статистика пари
###
 🎨 High Priority (Phase 2-3)

####
 16. Редизайн: Візуалізація тенісного столу

**
Цінність: Висока (UX диференціатор)
**

Інтерактивне відображення тенісного столу з гравцями навколо:
**
Основні елементи:
**

-
 Вигляд зверху на стіл (top-down view)
-
 4 позиції гравців (2v2) або 2 позиції (1v1)
-
 Аватарки/імена гравців на своїх позиціях
-
 Індикатор подаючого (анімований м'ячик)
-
 Рахунок на "табло" над столом
-
 Черга гравців збоку (як "трибуни")
-
 Лава запасних візуально окремо
**
Анімації:
**

-
 Перехід м'ячика при зміні подачі
-
 Святкування при виграші очка
-
 Плавна ротація гравців при зміні команд
-
 Пульсація для гравця, чия черга голосувати
**
Технічна реалізація:
**

-
 SVG або Canvas для столу
-
 Framer Motion для анімацій
-
 Responsive: вертикальний стіл на мобільних
**
Варіанти стилю:
**

-
 🎯 Мінімалістичний (плоский дизайн)
-
 🎮 Ретро-аркадний (піксель-арт)
-
 ✨ Сучасний 3D (ізометричний вигляд)
**
Wireframes:
**

📱 Mobile (до 768px)
```

┌──────────────────────────────┐
│  PING-A7X3        🏓 Матч    │
├──────────────────────────────┤
│ ЧЕМПІОНИ   [🎯Андрій][⚡Марія]│ ← горизонтальний ряд
├──────────────────────────────┤
│   ┌────────┐                 │
│   │        │      [7]        │
│   │  СТІЛ  │       :         │ ← вертикальний стіл + рахунок збоку
│   │(верт.) │      [5]        │
│   │        │                 │
│   └────────┘   Натисни щоб   │
│                 додати очко  │
├──────────────────────────────┤
│ ПРЕТЕНДЕНТИ  [🔥Олег][💫Ірина]│
├──────────────────────────────┤
│ [🏆 Чемпіони] [⚔️ Претенденти]│ ← голосування
├──────────────────────────────┤
│ ⏳ Черга: 🎮Петро 🌟Наталя    │
│ 🪑 Лава: 🎪Віктор             │
└──────────────────────────────┘

```

🖥️ Desktop (768px+)
```

┌─────────────────────────────────────────────────────┐
│                    [7] : [5]                        │
├─────────────────────────────────────────────────────┤
│            │                         │              │
│ ЧЕМПІОНИ   │                         │  ПРЕТЕНДЕНТИ │
│ [🎯Андрій] │    СТІЛ (горизонт.)     │   [🔥Олег]   │
│ [⚡Марія]  │          |||            │   [💫Ірина]  │
│            │                         │              │
└─────────────────────────────────────────────────────┘

```

**
Адаптивні зміни:
**

|
 Аспект 
|
 Mobile 
|
 Desktop 
|

|
--------
|
--------
|
---------
|

|
 Стіл 
|
 Вертикальний 
|
 Горизонтальний 
|

|
 Команди 
|
 Рядками зверху/знизу 
|
 Колонками зліва/справа 
|

|
 Рахунок 
|
 Збоку від столу (tap to add) 
|
 Зверху по центру 
|

|
 Кнопки 
|
 Touch-friendly (48px+ висота) 
|
 Стандартні 
|

|
 Spacing 
|
 Компактний (p-3, gap-3) 
|
 Просторіший (p-6, gap-5) 
|


---

###
 🔧 Medium Priority (Phase 3)

####
 8. Офлайн режим + PWA

**
Цінність: Середня
**

-
 Service Worker для кешування
-
 Локальна гра без інтернету
-
 Синхронізація при відновленні з'єднання
-
 Install prompt на мобільних
####
 9. Кастомізація правил

**
Цінність: Середня
**

-
 Гра до X очок (11, 15, 21)
-
 Різниця 2 очки (так/ні)
-
 Кількість сетів
-
 Час на матч (таймер)
-
 Власні правила фори
####
 10. Сповіщення

**
Цінність: Середня
**

-
 Push-нотифікації: "Твоя черга грати!"
-
 Telegram/Viber bot інтеграція
-
 Email дайджест статистики (тижневий)
####
 11. Соціальні фічі

**
Цінність: Середня
**

-
 Коментарі до матчів
-
 Реакції (🔥, 😱, 👏)
-
 Шерінг результатів у соцмережі
-
 QR-код для швидкого приєднання
###
 📊 Lower Priority (Phase 4)

####
 12. Аналітика та AI

**
Цінність: Нижча (але wow-ефект)
**

-
 Графіки прогресу гравця
-
 Прогноз результату матчу на основі історії
-
 Рекомендації партнерів для балансу команд
-
 Heat map активності (коли найчастіше граєте)
####
 13. Мультимовність

**
Цінність: Залежить від аудиторії
**

-
 UA (є)
-
 EN
-
 PL (для діаспори)
####
 14. Темна тема

**
Цінність: Базова UX потреба
**

-
 Автоматичне визначення системної теми
-
 Ручне перемикання
####
 15. Звукові ефекти

**
Цінність: Нижча
**

-
 Звук при голі
-
 Звук при перемозі
-
 Можливість вимкнути
---

##
 Архітектурні покращення

###
 База даних

**
Поточна структура (Firebase Realtime DB):
**

```

rooms/
  PING-XXXX/
    players/
    teams/
    queue/
    ...

```

**
Рекомендована структура (Firestore):
**

```

users/
  {uid}/
    displayName
    photoURL
    stats: { wins, losses, streak }
    achievements[]
    friends[]
matches/
  {matchId}/
    roomCode
    timestamp
    players[]
    teams[]
    score
    serveStats?
rooms/
  {code}/
    mode: '1v1' | '2v2'
    settings: { pointsToWin, handicapEnabled }
    ...
leaderboard/
  global/
    {uid}: { wins, losses, winRate, elo }

```

**
Рекомендація:
**
 Мігрувати на Firestore для:
-
 Кращих запитів (індекси, compound queries)
-
 Offline persistence
-
 Кращої структури для складних даних
###
 Безпека

1.
 
**
Firebase Security Rules
**
 — обов'язково до продакшену
2.
 
**
Rate limiting
**
 — захист від спаму
3.
 
**
Input validation
**
 — санітизація імен, кодів кімнат
4.
 
**
Anti-cheat
**
 — валідація голосів на сервері (Cloud Functions)
---

##
 Фазовий план розробки

```

┌─────────────────────────────────────────────────────────────────┐
│                        PHASE 1: Foundation                       │
│                          (2-3 тижні)                            │
├─────────────────────────────────────────────────────────────────┤
│ ☐ Firebase Authentication (Google + Anonymous)                  │
│ ☐ Міграція на Firestore                                         │
│ ☐ Security Rules                                                │
│ ☐ User profiles (базові)                                        │
│ ☐ Персистентна статистика гравця                                │
│ ☐ Unit тести для game logic                                     │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      PHASE 2: Core Features                      │
│                          (3-4 тижні)                            │
├─────────────────────────────────────────────────────────────────┤
│ ☐ Режим 1 на 1                                                  │
│ ☐ Глобальний лідерборд                                          │
│ ☐ Історія матчів                                                │
│ ☐ Детальний трекінг очок (опціонально)                          │
│ ☐ Трекінг подач                                                 │
│ ☐ Досягнення (перша ітерація — 10 бейджів)                      │
│ ☐ PWA manifest + basic offline                                  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                       PHASE 3: Social                           │
│                          (3-4 тижні)                            │
├─────────────────────────────────────────────────────────────────┤
│ ☐ Друзі (add/remove/invite)                                     │
│ ☐ Push notifications                                            │
│ ☐ Турнірний режим (single elimination)                          │
│ ☐ Шерінг результатів                                            │
│ ☐ QR-код для приєднання                                         │
│ ☐ Кастомізація правил гри                                       │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                       PHASE 4: Polish                           │
│                          (2-3 тижні)                            │
├─────────────────────────────────────────────────────────────────┤
│ ☐ Темна тема                                                    │
│ ☐ Мультимовність (EN)                                           │
│ ☐ Звукові ефекти                                                │
│ ☐ Розширена аналітика                                           │
│ ☐ Telegram bot                                                  │
│ ☐ Performance optimization                                      │
└─────────────────────────────────────────────────────────────────┘

```

---

##
 Оцінка складності фіч

|
 Фіча 
|
 Складність 
|
 Час 
|
 Залежності 
|

|
------
|
-----------
|
-----
|
------------
|

|
 Firebase Auth 
|
 🟡 Середня 
|
 3-5 днів 
|
 — 
|

|
 Firestore міграція 
|
 🟡 Середня 
|
 3-4 дні 
|
 — 
|

|
 Security Rules 
|
 🟢 Низька 
|
 1-2 дні 
|
 Auth 
|

|
 User profiles 
|
 🟢 Низька 
|
 2-3 дні 
|
 Auth 
|

|
 Режим 1v1 
|
 🟢 Низька 
|
 2-3 дні 
|
 — 
|

|
 Глобальний лідерборд 
|
 🟡 Середня 
|
 3-4 дні 
|
 Auth, Firestore 
|

|
 Історія матчів 
|
 🟢 Низька 
|
 2-3 дні 
|
 Firestore 
|

|
 Трекінг подач 
|
 🟡 Середня 
|
 4-5 днів 
|
 — 
|

|
 Детальний трекінг очок 
|
 🟡 Середня 
|
 3-4 дні 
|
 — 
|

|
 
**
Візуалізація столу
**
 
|
 🟠 Висока 
|
 7-10 днів 
|
 — 
|

|
 Досягнення 
|
 🟡 Середня 
|
 4-5 днів 
|
 Auth 
|

|
 PWA 
|
 🟢 Низька 
|
 2-3 дні 
|
 — 
|

|
 Друзі 
|
 🟡 Середня 
|
 4-5 днів 
|
 Auth 
|

|
 Push notifications 
|
 🟠 Висока 
|
 5-7 днів 
|
 Auth, PWA 
|

|
 Турніри 
|
 🔴 Висока 
|
 7-10 днів 
|
 Auth 
|

|
 Кастомізація правил 
|
 🟢 Низька 
|
 2-3 дні 
|
 — 
|

|
 Темна тема 
|
 🟢 Низька 
|
 1-2 дні 
|
 — 
|

|
 i18n 
|
 🟢 Низька 
|
 2-3 дні 
|
 — 
|

|
 Telegram bot 
|
 🟠 Висока 
|
 5-7 днів 
|
 Backend 
|


---

##
 Технічний стек (рекомендації)

###
 Поточний

-
 Next.js 16 (App Router)
-
 React 19
-
 TypeScript
-
 Tailwind CSS v4
-
 Firebase Realtime Database
###
 Рекомендований апгрейд

-
 ✅ Next.js 16 (залишити)
-
 ✅ React 19 (залишити)
-
 ✅ TypeScript (залишити)
-
 ✅ Tailwind CSS v4 (залишити)
-
 🔄 
**
Firebase Firestore
**
 (замість Realtime DB)
-
 ➕ 
**
Firebase Authentication
**

-
 ➕ 
**
Firebase Cloud Functions
**
 (для серверної валідації)
-
 ➕ 
**
Zustand
**
 або 
**
Jotai
**
 (для складнішого стейту)
-
 ➕ 
**
React Query / SWR
**
 (для кешування даних)
-
 ➕ 
**
Vitest
**
 (тестування)
-
 ➕ 
**
next-intl
**
 (i18n)
---




## 📄 Ліцензія

MIT

## 👨‍💻 Автор

Створено з ❤️ для друзів та пінг-понгу!
